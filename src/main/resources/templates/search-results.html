<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>검색 결과 - 검색 엔진</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="/css/style.css" rel="stylesheet">
</head>
<body>
    <div class="container-fluid">
        <!-- 헤더 -->
        <nav class="navbar navbar-expand-lg navbar-dark bg-primary mb-4">
            <div class="container">
                <a class="navbar-brand" href="/">
                    <i class="fas fa-search me-2"></i>
                    검색 엔진
                </a>
            </div>
        </nav>

        <div class="container">
            <div class="row">
                <!-- 사이드바 (필터) -->
                <div class="col-lg-3">
                    <div class="sidebar">
                        <div class="card border-0 shadow-sm mb-4">
                            <div class="card-header bg-light">
                                <h6 class="mb-0">
                                    <i class="fas fa-filter me-2"></i>검색 필터
                                </h6>
                            </div>
                            <div class="card-body">
                                <form th:action="@{/search}" th:object="${searchRequest}" method="post">
                                    <input type="hidden" th:field="*{query}">
                                    
                                    <div class="mb-3">
                                        <label for="sidebarCategory" class="form-label">카테고리</label>
                                        <select th:field="*{category}" class="form-select form-select-sm" id="sidebarCategory">
                                            <option value="">전체</option>
                                            <option th:each="cat : ${categories}" 
                                                    th:value="${cat}" 
                                                    th:text="${cat}"></option>
                                        </select>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label for="sidebarAuthor" class="form-label">작성자</label>
                                        <select th:field="*{author}" class="form-select form-select-sm" id="sidebarAuthor">
                                            <option value="">전체</option>
                                            <option th:each="auth : ${authors}" 
                                                    th:value="${auth}" 
                                                    th:text="${auth}"></option>
                                        </select>
                                    </div>
                                    
                                    <button type="submit" class="btn btn-primary btn-sm w-100">
                                        <i class="fas fa-filter me-1"></i>필터 적용
                                    </button>
                                </form>
                            </div>
                        </div>

                        <!-- 검색 통계 -->
                        <div class="card border-0 shadow-sm">
                            <div class="card-header bg-light">
                                <h6 class="mb-0">
                                    <i class="fas fa-chart-bar me-2"></i>검색 정보
                                </h6>
                            </div>
                            <div class="card-body">
                                <div class="d-flex justify-content-between mb-2">
                                    <span class="text-muted">총 결과:</span>
                                    <strong th:text="${searchResponse.totalElements}">0</strong>
                                </div>
                                <div class="d-flex justify-content-between mb-2">
                                    <span class="text-muted">검색 시간:</span>
                                    <strong th:text="${searchResponse.searchTime} + 'ms'">0ms</strong>
                                </div>
                                <div class="d-flex justify-content-between">
                                    <span class="text-muted">현재 페이지:</span>
                                    <strong th:text="${searchResponse.currentPage + 1} + '/' + ${searchResponse.totalPages}">1/1</strong>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 메인 콘텐츠 -->
                <div class="col-lg-9">
                    <!-- 검색 바 (상단) -->
                    <div class="search-header mb-4">
                        <form th:action="@{/search}" th:object="${searchRequest}" method="post">
                            <div class="input-group">
                                <span class="input-group-text bg-white">
                                    <i class="fas fa-search text-muted"></i>
                                </span>
                                <input type="text" 
                                       th:field="*{query}" 
                                       class="form-control search-input" 
                                       placeholder="검색어를 입력하세요..."
                                       autocomplete="off"
                                       id="topSearchInput">
                                <button class="btn btn-primary" type="submit">
                                    <i class="fas fa-search"></i>
                                </button>
                            </div>
                            <div id="topAutocompleteDropdown" class="autocomplete-dropdown"></div>
                        </form>
                    </div>

                    <!-- 검색 결과 헤더 -->
                    <div class="results-header mb-4">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <h4 class="mb-1">
                                    "<span th:text="${searchRequest.query}" class="text-primary"></span>" 검색 결과
                                </h4>
                                <p class="text-muted mb-0">
                                    총 <strong th:text="${searchResponse.totalElements}">0</strong>개의 결과를 
                                    <strong th:text="${searchResponse.searchTime}">0</strong>ms에 찾았습니다.
                                </p>
                            </div>
                            <div class="dropdown">
                                <button class="btn btn-outline-secondary dropdown-toggle btn-sm" type="button" 
                                        data-bs-toggle="dropdown">
                                    <i class="fas fa-sort me-1"></i>정렬
                                </button>
                                <ul class="dropdown-menu">
                                    <li><a class="dropdown-item" href="#"><i class="fas fa-star me-2"></i>관련도순</a></li>
                                    <li><a class="dropdown-item" href="#"><i class="fas fa-clock me-2"></i>최신순</a></li>
                                    <li><a class="dropdown-item" href="#"><i class="fas fa-eye me-2"></i>조회수순</a></li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <!-- 검색 결과 목록 -->
                    <div class="search-results">
                        <div th:if="${searchResponse.documents.empty}" class="text-center py-5">
                            <i class="fas fa-search fa-3x text-muted mb-3"></i>
                            <h5 class="text-muted">검색 결과가 없습니다</h5>
                            <p class="text-muted">다른 검색어를 시도해보세요.</p>
                        </div>

                        <div th:each="document : ${searchResponse.documents}" class="result-item mb-4">
                            <div class="card border-0 shadow-sm h-100">
                                <div class="card-body">
                                    <div class="d-flex justify-content-between align-items-start mb-2">
                                        <h5 class="card-title mb-1">
                                            <a th:href="${document.url}" 
                                               th:text="${document.title}" 
                                               class="text-decoration-none result-title"></a>
                                        </h5>
                                        <div class="result-meta">
                                            <span th:if="${document.category}" 
                                                  class="badge bg-primary me-1" 
                                                  th:text="${document.category}"></span>
                                        </div>
                                    </div>
                                    
                                    <p class="card-text text-muted mb-2" 
                                       th:text="${#strings.abbreviate(document.content, 200)}"></p>
                                    
                                    <div class="result-footer d-flex justify-content-between align-items-center">
                                        <div class="result-info">
                                            <small class="text-muted">
                                                <i class="fas fa-user me-1"></i>
                                                <span th:text="${document.author}"></span>
                                                <i class="fas fa-calendar ms-3 me-1"></i>
                                                <span th:text="${#temporals.format(document.createdAt, 'yyyy-MM-dd')}"></span>
                                            </small>
                                        </div>
                                        <div class="result-tags">
                                            <span th:each="tag : ${document.tags}" 
                                                  class="badge bg-light text-dark border me-1" 
                                                  th:text="${tag}"></span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 페이지네이션 -->
                    <nav th:if="${searchResponse.totalPages > 1}" aria-label="검색 결과 페이지네이션">
                        <ul class="pagination justify-content-center">
                            <li class="page-item" th:classappend="${searchResponse.currentPage == 0} ? 'disabled'">
                                <a class="page-link" th:href="@{/search(query=${searchRequest.query}, page=${searchResponse.currentPage - 1}, category=${searchRequest.category}, author=${searchRequest.author})}">
                                    <i class="fas fa-chevron-left"></i>
                                </a>
                            </li>
                            
                            <li th:each="pageNum : ${#numbers.sequence(0, searchResponse.totalPages - 1)}" 
                                class="page-item" 
                                th:classappend="${pageNum == searchResponse.currentPage} ? 'active'">
                                <a class="page-link" 
                                   th:href="@{/search(query=${searchRequest.query}, page=${pageNum}, category=${searchRequest.category}, author=${searchRequest.author})}"
                                   th:text="${pageNum + 1}"></a>
                            </li>
                            
                            <li class="page-item" th:classappend="${searchResponse.currentPage == searchResponse.totalPages - 1} ? 'disabled'">
                                <a class="page-link" th:href="@{/search(query=${searchRequest.query}, page=${searchResponse.currentPage + 1}, category=${searchRequest.category}, author=${searchRequest.author})}">
                                    <i class="fas fa-chevron-right"></i>
                                </a>
                            </li>
                        </ul>
                    </nav>
                </div>
            </div>
        </div>
    </div>

    <!-- 푸터 -->
    <footer class="bg-light mt-5 py-4">
        <div class="container text-center">
            <p class="text-muted mb-0">
                &copy; 2024 검색 엔진. Made with 
                <i class="fas fa-heart text-danger"></i> 
                using Spring Boot, Elasticsearch & MongoDB
            </p>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/js/search.js"></script>
</body>
</html> 